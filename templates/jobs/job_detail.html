{% extends 'base.html' %}
{% load static %}

{% block title %}{{ job.title }} at {{ job.company }} - JobRite.com{% endblock %}

{% block content %}
<!-- Job Header Section -->
<section class="bg-primary py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-lg p-8 shadow-lg">
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
                <div class="flex-1">
                    <div class="flex items-start space-x-4 mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br {% if job.category == 'call-center' %}from-blue-400 to-blue-600{% elif job.category == 'customer-care' %}from-green-400 to-green-600{% elif job.category == 'sales' %}from-purple-400 to-purple-600{% elif job.category == 'hr' %}from-red-400 to-red-600{% elif job.category == 'it' %}from-indigo-400 to-indigo-600{% elif job.category == 'logistics' %}from-teal-400 to-teal-600{% else %}from-orange-400 to-orange-600{% endif %} rounded-lg flex items-center justify-center flex-shrink-0">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h1 class="text-3xl font-bold text-text-primary mb-2">
                                {{ job.title }}
                                {% if job.is_featured %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-accent text-white ml-2">
                                    Featured
                                </span>
                                {% endif %}
                            </h1>
                            <p class="text-xl text-accent font-semibold mb-4">{{ job.company }}</p>
                            
                            <!-- Job Details -->
                            <div class="flex flex-wrap gap-3 mb-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800">
                                    üìç {{ job.location }}
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
                                    {{ job.get_job_type_display }}
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                                    {{ job.get_category_display }}
                                </span>
                                {% if job.salary_range %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800">
                                    üí∞ {{ job.salary_range }}
                                </span>
                                {% endif %}
                                {% if job.is_remote %}
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-orange-100 text-orange-800">
                                    üè† Remote
                                </span>
                                {% endif %}
                            </div>
                            
                            <p class="text-sm text-text-secondary">
                                Posted {{ job.created_at|timesince }} ago
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Application Actions -->
                <div class="mt-6 lg:mt-0 lg:ml-8 flex flex-col space-y-3">
                    {% if user.is_authenticated %}
                        {% if has_applied %}
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                                <svg class="w-8 h-8 text-green-600 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <p class="text-green-800 font-semibold">Application Submitted</p>
                                <p class="text-sm text-green-600 mt-1">Status: {{ user_application.get_status_display }}</p>
                                <a href="{% url 'jobs:my_applications' %}" class="text-sm text-green-700 hover:text-green-800 underline mt-2 inline-block">
                                    View My Applications
                                </a>
                            </div>
                        {% else %}
                            <button 
                                onclick="quickApply({{ job.id }})"
                                class="bg-accent text-white px-8 py-3 rounded-lg hover:bg-orange-600 transition-colors duration-200 font-semibold text-center"
                                id="quick-apply-btn"
                            >
                                Quick Apply
                            </button>
                            <a 
                                href="{% url 'jobs:apply_for_job' job.id %}"
                                class="border-2 border-accent text-accent px-8 py-3 rounded-lg hover:bg-accent hover:text-white transition-colors duration-200 font-semibold text-center inline-block"
                            >
                                Apply with Cover Letter
                            </a>
                        {% endif %}
                    {% else %}
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <p class="text-blue-800 font-semibold mb-2">Sign in to Apply</p>
                            <a href="{% url 'users:login' %}?next={% url 'jobs:job_detail' job.id %}" class="bg-accent text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors duration-200 font-semibold inline-block">
                                Sign In
                            </a>
                        </div>
                    {% endif %}
                    
                    <button class="border border-gray-300 text-text-primary px-8 py-3 rounded-lg hover:bg-gray-50 transition-colors duration-200 font-semibold">
                        Save Job
                    </button>
                    <button class="border border-gray-300 text-text-primary px-8 py-3 rounded-lg hover:bg-gray-50 transition-colors duration-200 font-semibold">
                        Share Job
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Job Content Section -->
<section class="py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2">
                <!-- Job Description -->
                <div class="bg-white rounded-lg shadow-md p-8 mb-8">
                    <h2 class="text-2xl font-bold text-text-primary mb-6">Job Description</h2>
                    <div class="prose prose-lg max-w-none text-text-secondary">
                        {{ job.description|linebreaks }}
                    </div>
                </div>
                
                <!-- Requirements -->
                <div class="bg-white rounded-lg shadow-md p-8">
                    <h2 class="text-2xl font-bold text-text-primary mb-6">Requirements</h2>
                    <div class="prose prose-lg max-w-none text-text-secondary">
                        {{ job.requirements|linebreaks }}
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <!-- Company Info -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-xl font-bold text-text-primary mb-4">About {{ job.company }}</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H7m2 0v-4a2 2 0 012-2h2a2 2 0 012 2v4"></path>
                            </svg>
                            <span class="text-text-secondary">{{ job.company }}</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <span class="text-text-secondary">{{ job.location }}</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="text-text-secondary">{{ job.get_job_type_display }}</span>
                        </div>
                        {% if job.salary_range %}
                        <div class="flex items-center space-x-3">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            <span class="text-text-secondary">{{ job.salary_range }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Similar Jobs -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-text-primary mb-4">Similar Jobs</h3>
                    <div class="space-y-4">
                        <!-- This would be populated with similar jobs in a real implementation -->
                        <p class="text-text-secondary text-sm">Similar job recommendations will appear here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Back to Search -->
<section class="py-8 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <a href="{% url 'jobs:search' %}" class="inline-flex items-center text-accent hover:text-orange-600 transition-colors duration-200">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Job Search
        </a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function quickApply(jobId) {
    const btn = document.getElementById('quick-apply-btn');
    const originalText = btn.textContent;
    
    // Disable button and show loading state
    btn.disabled = true;
    btn.textContent = 'Applying...';
    btn.classList.add('opacity-50');
    
    // Get CSRF token
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch(`/job/${jobId}/quick-apply/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json',
        },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            btn.textContent = 'Applied Successfully!';
            btn.classList.remove('bg-accent', 'hover:bg-orange-600');
            btn.classList.add('bg-green-600');
            
            // Reload page after a short delay to show updated state
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            // Show error message
            alert(data.message);
            btn.disabled = false;
            btn.textContent = originalText;
            btn.classList.remove('opacity-50');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
        btn.disabled = false;
        btn.textContent = originalText;
        btn.classList.remove('opacity-50');
    });
}
</script>
{% endblock %}